<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Multilingual Functional Texts</title>
  <base href="https://vickymx.github.io/MT/">
  <link rel="stylesheet" href="assets/styles.css?v=3">
</head>
<body>
  <header>
    <div class="logo"><a href="https://vickymx.github.io/MT/" style="color:inherit;text-decoration:none">FT</a></div>
    <div>Multilingual Functional Texts</div>
  </header>

  <main>
    <div class="controls">
      <select id="lang">
        <option value="bg">Български (BG)</option>
        <option value="en" selected>English (EN)</option>
        <option value="fr">Français (FR)</option>
      </select>
      <select id="category">
        <option value="all">All categories</option>
        <option value="medicine">Medicine</option>
        <option value="menus">Menus</option>
      </select>
    </div>

    <div id="grid" class="grid"></div>
    <p id="emptyMsg" style="display:none;color:#fff;opacity:.9;margin-top:12px">
      No data embedded. Run <code>python scripts/build_site.py</code> before deploying.
    </p>
  </main>

  <script>
    window.DATA = [{"id": "m1", "category": "medicine", "langs": {"bg": {"title": "Абидоакс", "content": "Абидоакс съдържа дабигатран етексилат (антикоагулант). При възрастни: профилактика на венозни тромби след смяна на колянна/тазобедрена става. При деца: разтваря съществуващи тромби и предотвратява повторно образуване."}, "en": {"title": "Abidoax", "content": "Abidoax contains dabigatran etexilate (anticoagulant). Adults: prevents venous clots after knee/hip replacement. Children: dissolves existing clots and prevents recurrence."}, "fr": {"title": "Abidoax", "content": "Abidoax contient du dabigatran étexilate (anticoagulant). Adultes : prévention des caillots veineux après prothèse du genou/de la hanche. Enfants : dissout les caillots existants et empêche leur récidive."}}}];

    function render(){
      const grid = document.getElementById('grid');
      const msg  = document.getElementById('emptyMsg');
      const lang = document.getElementById('lang').value;
      const cat  = document.getElementById('category').value;

      const data = (window.DATA && Array.isArray(window.DATA)) ? window.DATA : [];
      grid.innerHTML = '';

      if (!data.length) {
        msg.style.display = 'block';
        return;
      } else {
        msg.style.display = 'none';
      }

      const items = data.filter(e => cat === 'all' || e.category === cat);
      for (const it of items) {
        const L = it.langs[lang];
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
          <div class="meta">
            <span class="badge ${it.category}">${it.category}</span>
            <span>#${it.id}</span>
          </div>
          <h3>${L.title}</h3>
          <p>${L.content}</p>
        `;
        grid.appendChild(el);
      }

      const url = new URL("https://vickymx.github.io/MT/");
      url.searchParams.set('lang', lang);
      url.searchParams.set('category', cat);
      history.replaceState({}, '', url);
    }

    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);
      if (params.get('lang')) document.getElementById('lang').value = params.get('lang');
      if (params.get('category')) document.getElementById('category').value = params.get('category');
      document.getElementById('lang').addEventListener('change', render);
      document.getElementById('category').addEventListener('change', render);
      render();
    });
  </script>
</body>
</html>
